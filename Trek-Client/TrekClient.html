<html>
	<head>
	<!-- Prevents mobile device from zooming in on double tap -->
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	<meta name="HandheldFriendly" content="true" />
	
	<script type="text/javascript">
		
		var ip = "ws://192.168.1.142:8000";
		
		var webSocket = new WebSocket(ip);

		var elements;
		
		buttonImg = new Image();
		buttonImg.src = "button.png";
		
		buttonHoverImg = new Image();
		buttonHoverImg.src = "buttonHovered.png";
		
		buttonPressedImg = new Image();
		buttonPressedImg.src = "buttonPressed.png"
			
		window.oncontextmenu = function(event) 
		{
			event.preventDefault();
			event.stopPropagation();
			return false;
		};
			
		window.onload = function () 
		{
			document.body.style.webkitTouchCallout='none';
			document.body.style.webkitUserSelect='none';
			
			/*
			window.gesturestart = function (e) 
			{
				e.preventDefault();
			}
			*/
		}
		
		webSocket.onopen = function(event)
		{
			console.log("Websocket open");
		}
		
		webSocket.onerror = function(event)
		{
			alert("There was an error connecting to the server");
		}
		
		webSocket.onmessage = function(event) 
		{
			console.log("Message received!");

			elements = JSON.parse(event.data);
			
			console.log(elements.length);
			
			for(i = 0; i < elements.length; i++)
			{
				switch(elements[i].type)
				{
					case "BUTTON":
						console.log("Recieved button: " + elements[i].id);
						createButton(document.body, elements[i].id);
						break;
					case "JOYSTICK":
						console.log("Received joystick: " + elements[i].id);
						break;
					default:
						console.log("Received unknown element: " + elements[i].id);
						break;
				}
			}
		};
		
		function createButton(context, buttonId)
		{			
			var img = document.createElement("img");
			id = buttonId;
			img.name = buttonId + "Img"; 
			img.src = buttonImg.src; 
			img.width = "200";
			img.height = "200"; 
			img.alt = "javascript button";

			button = document.createElement("p");
			button.href = "#";
			button.id = buttonId;
			button.style.background = "none";
			button.style.border = "none";
			button.style.outline = "none";
			
			button.appendChild(img);
			context.appendChild(button);
			
			//Please be careful with this code, it is VERY finnicky
			document.getElementById(buttonId).ontouchstart = function(){onButtonPress(this.id);}
			document.getElementById(buttonId).ontouchend = function(){onStopButtonPress(this.id);}
			
		}
		
		function onButtonHover(buttonId)
		{
			document.images[buttonId + "Img"].src = buttonHoverImg.src;
			return true;
		}
		function onStopButtonHover(buttonId)
		{
			document.images[buttonId + "Img"].src = buttonImg.src;
			return true;
		}
		function onButtonPress(buttonId)
		{
			//When the button is pressed, send the server some data
		
			webSocket.send("BUTTON:" + buttonId + ":state:" + "true");
			
			document.images[buttonId + "Img"].src = buttonPressedImg.src;
			
			return true;
		}
		function onStopButtonPress(buttonId)
		{
			webSocket.send("BUTTON:" + buttonId + ":state:" + "false");
		
			document.images[buttonId + "Img"].src = buttonImg.src;
			return true;
		}
	</script>
	
	</head>
	
	<body>
	</body>
</html>